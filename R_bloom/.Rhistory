install.packages("tidyverse")
install.packages("tidyverse")
install.packages("tidyverse")
install.packages("tidyverse")
climate_imputed_new <- select(climate_imputed,-(year))
library(tidyverse)
climate_imputed<-read.table('../data/kyoto_climate_imputed.txt' ,sep=",", header=TRUE)
climate_imputed$DATE = as.Date(climate_imputed$DATE )
climate_imputed$doy = NULL
str(climate_imputed)
library(tidyverse)
climate_imputed_new <- select(climate_imputed,-(year))
#str(climate_imputed_new)
ggplot(data=climate_imputed_new, aes(x = DATE, y = average_temperature)) +
geom_point() +
labs(title = "average_temp_kyoto")
install.packages("timetk")
install.packages("timetk")
update.packages()
update.packages()
update.packages()
.libPaths()
install.packages("timetk")
library(tidyverse)
library(timetk)
climate_imputed<-read.table('../data/kyoto_climate_imputed.txt' ,sep=",", header=TRUE)
climate_imputed$DATE = as.Date(climate_imputed$DATE )
climate_imputed$doy = NULL
str(climate_imputed)
climate_imputed_new <- select(climate_imputed,-(year))
#str(climate_imputed_new)
ggplot(data=climate_imputed_new, aes(x = DATE, y = average_temperature)) +
geom_point() +
labs(title = "average_temp_kyoto")
# This line maybe used to filter the data
#precip_boulder_AugOct <- boulder_daily_precip %>%
#                        filter(DATE >= as.Date('2013-08-15') & DATE <= as.Date('2013-10-15'))
resample_spec <- time_series_cv(data = climate_imputed_new,
initial     = "6 years",
assess      = "24 months",
skip        = "24 months",
cumulative  = FALSE,
slice_limit = 3)
resample_spec
resample_spec <- time_series_cv(data = climate_imputed_new,
initial     = "10 years",
assess      = "12 months",
cumulative  = FALSE,)
resample_spec
resample_spec <- time_series_cv(data = climate_imputed_new,
initial     = "10 years",
assess      = "12 months",
cumulative  = FALSE,)
resample_spec
resample_spec %>% tk_time_series_cv_plan()
splits <- climate_imputed_new %>%
time_series_split(assess = "3 months", cumulative = TRUE)
#resample_spec <- time_series_cv(data = climate_imputed_new,
#                                initial     = "10 years",
#                                assess      = "12 months",
#                                cumulative  = FALSE,)
#resample_spec
#resample_spec %>% tk_time_series_cv_plan()
splits %>%
tk_time_series_cv_plan() %>%
plot_time_series_cv_plan(date, value, .interactive = interactive)
rlang::last_error()
splits
View(climate_imputed_new)
View(climate_imputed_new)
View(climate_imputed_new)
View(climate_imputed_new)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
library(tidyverse)
library(timetk)
climate_imputed<-read.table('../data/kyoto_climate_imputed.txt' ,sep=",", header=TRUE)
climate_imputed$DATE = as.Date(climate_imputed$DATE )
climate_imputed$doy = NULL
str(climate_imputed)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% left_join(climate_imputed,by="year")
bloom_test
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test %>%
mutate(Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = date,
.formula      = log(value) ~ as.numeric(date) + month(date, label = TRUE),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = date,
.formula      = log(average_temperature) ~ as.numeric(date) + month(date, label = TRUE),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
bloom_test %>%
group_by(year)
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = log(average_temperature) ~ DATE
.facet_ncol   = 2,
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = log(average_temperature) ~ as.numeric(DATE)
.facet_ncol   = 2,
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = log(average_temperature) ~ as.numeric(DATE),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = Status ~ average_temperature,
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = Status ~ as.numeric(average_temperature),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = TRUE
)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test %>%
mutate(Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test$Status = as.numeric(bloom_result$Status)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test %>%
mutate(Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test$Status# = as.numeric(bloom_result$Status)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test %>%
mutate(Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
)) %>% bloom_test
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test
mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
#bloom_test$Status# = as.numeric(bloom_result$Status)
bloom_test$Status
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test<-mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
#bloom_test$Status# = as.numeric(bloom_result$Status)
bloom_test
bloom_test$Status
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = as.numeric(Status) ~ as.numeric(average_temperature),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = TRUE
)
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = as.numeric(Status) ~ as.numeric(average_temperature),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
which(is.na(bloom_test)
;
which(is.na(bloom_test))
bloomtest[24614]
bloom_test[24614]
bloom_test[24613]
bloom_test["273"]
View(bloom_test)
View(bloom_test)
bloom_test %>% drop_na()
View(bloom_test)
View(bloom_test)
test_b<-bloom_test %>% drop_na()
View(test_b)
bloom_test<-bloom_test %>% drop_na()
bloom_test<-bloom_test %>% drop_na()
bloom_test %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = as.numeric(Status) ~ as.numeric(average_temperature),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
View(resample_spec)
View(resample_spec)
f
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test<-mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test %>%
group_by(year) %>%
plot_time_series_boxplot(
DATE, average_temperature,
.period      = "1 year",
.facet_ncol  = 2,
.interactive = FALSE)
#bloom_test$Status# = as.numeric(bloom_result$Status)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test<-mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test %>%
group_by(year) %>%
plot_time_series(
DATE, average_temperature,
.color_var = month(DATE, label = TRUE),
.period      = "1 year",
.interactive = FALSE)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test<-mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test %>%
group_by(year) %>%
plot_time_series(
DATE, average_temperature,
.color_var = month(DATE, label = TRUE),
.interactive = FALSE)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test<-mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test %>%
group_by(year) %>%
plot_time_series(
DATE, average_temperature,
.color_var = month,
.interactive = FALSE)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test<-mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test %>%
group_by(year) %>%
plot_time_series(
DATE, average_temperature,
.interactive = FALSE)
#bloom_test$Status# = as.numeric(bloom_result$Status)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test<-mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test%>%filter(DATE >= as.Date('2000-01-01') & DATE <= as.Date('2022-01-01')) %>%
group_by(year) %>%
plot_time_series(
DATE, average_temperature,
.interactive = FALSE)
#bloom_test$Status# = as.numeric(bloom_result$Status)
bloom_result<-read.table('../data/kyoto.csv' ,sep=",", header=TRUE)
bloom_result$bloom_date = as.Date(bloom_result$bloom_date)
bloom_test=bloom_result %>% right_join(climate_imputed,by="year")
bloom_test<-mutate(bloom_test,Status = case_when(
DATE>=bloom_date ~ 1,
DATE<bloom_date ~ 0
))
bloom_test%>%filter(DATE >= as.Date('2019-01-01') & DATE <= as.Date('2022-01-01')) %>%
group_by(year) %>%
plot_time_series(
DATE, average_temperature,
.interactive = FALSE)
#bloom_test$Status# = as.numeric(bloom_result$Status)
bloom_test<-bloom_test %>% drop_na()
bloom_test %>%filter(DATE >= as.Date('2019-01-01') & DATE <= as.Date('2022-01-01')) %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = as.numeric(Status) ~ as.numeric(average_temperature),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
bloom_test<-bloom_test %>% drop_na()
bloom_test %>%filter(DATE >= as.Date('2019-01-01') & DATE <= as.Date('2022-01-01')) %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = log(as.numeric(Status)) ~ as.numeric(average_temperature),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
bloom_test<-bloom_test %>% drop_na()
bloom_test %>%filter(DATE >= as.Date('2019-01-01') & DATE <= as.Date('2022-01-01')) %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = as.numeric(Status) ~ as.numeric(average_temperature),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
bloom_test%>%
group_by(year) %>% # group by the day column
summarise(total_precip=sum(average_temperature)) ->bloom_test$CDD
bloom_test%>%
group_by(year) %>% # group by the day column
summarise(CDD=sum(average_temperature))
splits <- bloom_test %>%
time_series_split(assess = "1 year", cumulative = TRUE)
#resample_spec <- time_series_cv(data = climate_imputed_new,
#                                initial     = "10 years",
#                                assess      = "12 months",
#                                cumulative  = FALSE,)
#resample_spec
#resample_spec %>% tk_time_series_cv_plan()
View(splits)
View(splits)
splits <- bloom_test %>%
time_series_split(assess = "1 year", cumulative = TRUE)
recipe_spec_timeseries <- recipe(value ~ ., data = training(splits)) %>%
step_timeseries_signature(date)
splits <- bloom_test %>%
time_series_split(assess = "1 year", cumulative = TRUE)
library(recipes)
recipe_spec_timeseries <- recipe(value ~ ., data = training(splits)) %>%
step_timeseries_signature(date)
install.package("caTools")
glm(Status ~ average_temperature, family=binomial(link="logit"), data=bloom_test)
#bloom_test%>%
#group_by(year) %>% # group by the day column
#summarise(CDD=sum(average_temperature))
#all_year <- unique(bloom_test$year)
#for (i in all_year){
for (k in filter(bloom_test year == i))
#bloom_test%>%
#group_by(year) %>% # group by the day column
#summarise(CDD=sum(average_temperature))
#all_year <- unique(bloom_test$year)
#for (i in all_year){
# (k in filter(bloom_test year == i))
#
#}
mutate(group_by(bloom_test,year), csum=cumsum(average_temperature))
#bloom_test%>%
#group_by(year) %>% # group by the day column
#summarise(CDD=sum(average_temperature))
#all_year <- unique(bloom_test$year)
#for (i in all_year){
# (k in filter(bloom_test year == i))
#
#}
bloom_test<-mutate(group_by(bloom_test,year), CDD=cumsum(average_temperature))
bloom_test<-bloom_test %>% drop_na()
bloom_test %>%filter(DATE >= as.Date('2019-01-01') & DATE <= as.Date('2022-01-01')) %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = as.numeric(Status) ~ as.numeric(CDD),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
glm(Status ~ CDD, family=binomial(link="logit"), data=bloom_test)
bloom_test<-bloom_test %>% drop_na()
bloom_test %>%filter(DATE >= as.Date('2019-01-01') & DATE <= as.Date('2022-01-01')) %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = as.numeric(Status) ~ as.numeric(CDD)-800,
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
glm(Status ~ CDD-800, family=binomial(link="logit"), data=bloom_test)
View(bloom_test)
View(bloom_test)
View(bloom_result)
View(bloom_test)
bloom_test<-bloom_test %>% drop_na()
bloom_test %>%filter(DATE >= as.Date('2019-01-01') & DATE <= as.Date('2022-01-01')) %>%
group_by(year) %>%
plot_time_series_regression(
.date_var     = DATE,
.formula      = as.numeric(Status) ~ as.numeric(average_temperature),
.facet_ncol   = 2,
.interactive  = FALSE,
.show_summary = FALSE
)
glm(Status ~ CDD, family=binomial(link="logit"), data=bloom_test)
l0<-glm(Status ~ CDD, family=binomial(link="logit"), data=bloom_test)
summary(l0)
